# ============================================================================
# Fixed-Wing Cruise Optimization Scenario
# 순항 비행 최적화 - 순항 L/D 최대화
# ============================================================================
#
# Workflow:
#   Phase 1: Database screening (30분) - NACA library 스캔
#   Phase 2: Surrogate training (1-2시간) - Kriging model 구축
#   Phase 3: NACA optimization (1-2시간) - SLSQP 최적화
#   Phase 4: Validation - XFOIL polar 분석
#
# Application: 일반 항공기, 글라이더, 소형 무인기
# Complexity: ★☆☆☆☆ (가장 단순)
# Timeline: 1-2일
# ============================================================================

name: "Cruise Wing Optimization"
version: "1.0.0"

description: |
  고정익 항공기의 순항 익형 최적화.
  단일 설계점에서 양항비(L/D)를 최대화하여 순항 효율을 극대화.

  적용 분야:
  - 일반 항공기 (General Aviation)
  - 글라이더 (Gliders)
  - 소형 무인기 (Small UAVs)
  - 전기 항공기 (Electric Aircraft)

  Operating Condition (XFOIL Valid Range):
  - Reynolds: 50k - 50M (XFOIL reliable range)
  - Mach: 0 - 0.5 (with compressibility correction)
  - AoA: -5° - 15° (pre-stall region)

  특징:
  - NACA parametrization (3 variables) - 적은 변수로 빠른 최적화
  - XFOIL solver - Ma ≤ 0.5, Re 50k-50M에서 신뢰성 있음
  - Kriging surrogate - 적은 샘플로 좋은 정확도
  - SLSQP optimizer - 빠른 수렴

category: "fixed_wing"
application: "cruise_wing"
tier: 1 # SaaS Tier 1: Quick Analysis

# ============================================================================
# 형상 매개변수화
# ============================================================================
parametrization:
  method: "naca" # Primary: NACA 4-digit parametrization
  baseline: "naca2412"

  parameters:
    # NACA 4-digit: m (camber), p (position), t (thickness)
    # 총 3개 변수 - 물리적 타당성 보장
    bounds:
      max_camber: [0.0, 6.0] # 0-6% chord (m × 100)
      camber_pos: [1, 5] # 10-50% chord (p × 10)
      thickness: [9, 20] # 9-20% chord (t × 100)

    initial: [2, 4, 12] # NACA 2412 - 일반적인 시작점

    # Alternative parametrization (Phase 3 refinement)
    # 성능 추가 개선이 필요한 경우 CST로 전환
    alternative:
      method: "cst"
      n_upper: 6
      n_lower: 6
      note: "NACA optimal을 starting point로 CST refinement 가능"

# ============================================================================
# 설계점 (Design Points)
# ============================================================================
design_points:
  # Primary design point - 순항 조건
  - name: "cruise"
    reynolds: 3.0e6 # Re = 3M (소형 항공기, 5m wingspan @ 30m/s @ sea level)
    aoa: 3.0 # 순항 받음각 3°
    mach: 0.2 # Ma = 0.2 (약 68 m/s @ sea level)
    weight: 1.0 # 가중치 100%

  # Optional: Secondary design points for multi-point optimization
  # - name: "climb"
  #   reynolds: 2.5e6
  #   aoa: 5.0
  #   mach: 0.15
  #   weight: 0.3

  # - name: "loiter"
  #   reynolds: 2.0e6
  #   aoa: 4.0
  #   mach: 0.12
  #   weight: 0.2

# ============================================================================
# 목적함수 (Objective Function)
# ============================================================================
objectives:
  - type: "maximize"
    metric: "CL/CD" # 양항비 최대화
    weight: 1.0
    description: "순항 효율 최대화"

  # Alternative objectives (uncomment as needed):
  # - type: "maximize"
  #   metric: "CL^1.5/CD"   # 최대 항속 거리
  #   weight: 1.0

  # - type: "maximize"
  #   metric: "CL^3/CD^2"   # 최대 체공 시간
  #   weight: 1.0

# ============================================================================
# 제약 조건 (Constraints)
# ============================================================================
constraints:
  # 형상 제약
  geometry:
    - param: "thickness_ratio"
      min: 0.10 # 최소 10% 두께 (구조 강도)
      max: 0.20 # 최대 20% 두께 (항력 제한)
      description: "구조 강도 및 연료 탱크 체적 확보"

  # 공력 제약
  aerodynamic:
    - param: "CL"
      min: 0.4 # 최소 양력계수 (순항 하중 충족)
      max: null # 상한 없음
      description: "순항 양력 요구사항"

    - param: "CM"
      min: -0.10 # 최소 피칭 모멘트 (과도한 nose-down 방지)
      max: 0.0 # 최대 피칭 모멘트 (정적 안정성)
      description: "종안정성 요구사항"

    - param: "CL/CD"
      min: 50.0 # 최소 양항비
      description: "최소 성능 보장"

# ============================================================================
# 솔버 설정 (Solver Configuration)
# ============================================================================
solver:
  primary: "xfoil"

  # XFOIL 유효 범위 (Reliable Operating Envelope)
  valid_range:
    reynolds:
      min: 5.0e5 # 500,000 - 저 Re에서 transition 예측 정확도 저하
      max: 5.0e7 # 50,000,000 - 고 Re에서도 신뢰성 유지
      note: "Re < 50k는 laminar-dominant로 별도 검증 필요"

    mach:
      min: 0.0
      max: 0.5 # Prandtl-Glauert compressibility correction 적용
      note: "Ma > 0.5는 transonic 효과로 RANS 필요"

    alpha:
      min: -10.0 # 실속 전 범위
      max: 15.0 # 실속 전 범위 (익형에 따라 다름)
      note: "실속 근처 (CL_max 부근)는 정확도 저하"

  settings:
    ncrit: 8 # Critical amplification factor (비행 조건)
    n_panels: 240 # Panel 수
    max_iter: 300 # 최대 반복 횟수

  # Ncrit 가이드라인
  ncrit_guide:
    flight_clean: 10-11 # 비행 환경, 깨끗한 표면
    flight_rough: 7-9 # 비행 환경, 거친 표면/곤충
    wind_tunnel: 5-7 # 풍동 시험 (turbulence intensity 의존)
    turbulent: 1-3 # 높은 난류 환경

  validation: # 최종 설계 검증용
    method: "rans_2d"
    turbulence_model: "sst_k_omega"
    note: "설계점 및 off-design 2-3점 검증 (1-2일 소요)"

# ============================================================================
# Surrogate Model 설정
# ============================================================================
surrogate:
  method: "kriging" # Gaussian Process Regression
  training_samples: 80 # Total training samples (3 variables × ~25 samples/variable)

  settings:
    kernel: "matern" # Matérn 5/2 kernel (smooth, differentiable)
    length_scale: 1.0 # Initial length scale
    n_restarts: 10 # Kernel optimizer restarts
    normalize: true # Input/output normalization

  sampling:
    method: "lhs" # Latin Hypercube Sampling
    n_samples: 80 # 3 variables × ~25 samples/variable
    seed: 42 # Reproducibility

  validation:
    split: 0.2 # 20% for validation
    cv_folds: 5 # 5-fold cross-validation
    min_r2: 0.95 # Minimum acceptable R²

  # Alternative: Polynomial RSM (faster but less accurate)
  alternative:
    method: "polynomial"
    degree: 2
    n_samples: 40
    note: "더 빠른 구축, 덜 정확"

# ============================================================================
# 최적화 알고리즘 설정
# ============================================================================
optimization:
  algorithm: "scipy"
  method: "SLSQP" # Sequential Least Squares Programming
  max_iterations: 50 # 최대 반복 횟수

  settings:
    convergence_tol: 1.0e-6 # 수렴 조건
    eps: 1.0e-8 # Finite difference step
    n_multistart: 5 # Multi-start 횟수

  # Alternative: Bayesian Optimization
  alternative:
    method: "bayesian"
    n_calls: 50
    acq_func: "EI" # Expected Improvement
    note: "Global optimizer, 적은 평가 횟수에 효과적"

# ============================================================================
# 출력 설정
# ============================================================================
output:
  directory: "output/optimization/cruise_wing"

  files:
    optimal_airfoil: "optimal_airfoil.dat"
    optimization_history: "optimization_history.json"
    summary: "optimization_summary.json"
    surrogate_model: "surrogate_model.pkl"

  plots:
    enabled: true
    formats: ["png"] # png, pdf, svg
    dpi: 150

    generate:
      - convergence
      - airfoil_comparison
      - polar_comparison
      - design_space
      - surrogate_validation
      - summary_report

  validation:
    enabled: true
    polar_range: [-2, 12]
    polar_step: 0.5

# ============================================================================
# 워크플로우 설정
# ============================================================================
workflow:
  phases:
    phase1_screening:
      enabled: true
      description: "NACA database screening"
      estimated_time: "30 min"

    phase2_surrogate:
      enabled: true
      description: "Kriging surrogate training"
      estimated_time: "1-2 hours"

    phase3_optimization:
      enabled: true
      description: "SLSQP optimization"
      estimated_time: "1-2 hours"

    phase4_validation:
      enabled: true
      description: "XFOIL polar validation"
      estimated_time: "30 min"

  total_estimated_time: "3-5 hours (automated)"

  checkpoints:
    save_after_each_phase: true
    resume_from_checkpoint: true
