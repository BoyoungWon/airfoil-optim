# Airfoil Optimization Framework

Surrogate model 기반 airfoil 최적화 프레임워크입니다. XFOIL을 사용한 공력 해석과 다양한 형상 매개변수화 방법(NACA, CST, FFD)을 지원하며, Kriging, Neural Network 등의 surrogate model을 활용한 효율적인 최적화를 제공합니다.

## 주요 기능

- **다중 형상 매개변수화**: NACA (3 params), CST (8-30 params), FFD (15-100+ params)
- **Surrogate 모델**: Kriging/GPR, Neural Network, Polynomial RSM
- **최적화 알고리즘**: Scipy, Genetic Algorithm, Bayesian Optimization
- **다중 설계점 최적화**: 가중 평균 기반 multi-point optimization
- **시나리오 기반 실행**: YAML 설정 파일로 간편한 최적화 실행

## 환경 구성

### 필수 요구사항

- Docker
- Docker Compose

### 빠른 시작

1. **Docker 이미지 빌드 및 컨테이너 시작**

```bash
docker-compose up -d xfoil-dev
```

2. **개발 컨테이너 접속**

```bash
docker-compose exec xfoil-dev bash
```

3. **XFOIL 실행 확인**

```bash
xfoil
```

### 서비스 구성

#### xfoil-dev (메인 개발 환경)

XFOIL이 설치된 주 개발 환경입니다.

```bash
# 컨테이너 시작
docker-compose up -d xfoil-dev

# 컨테이너 접속
docker-compose exec xfoil-dev bash

# 컨테이너 종료
docker-compose down
```

#### jupyter (Jupyter Notebook 서버)

최적화 알고리즘 개발을 위한 Jupyter Notebook 환경입니다.

```bash
# Jupyter 서버 시작
docker-compose up -d jupyter

# 브라우저에서 접속: http://localhost:8888
# 토큰은 로그에서 확인 # XFOIL 소스 코드
├── scripts/                 # Python 스크립트
│   ├── generate_naca_airfoil.py   # NACA airfoil 생성
│   ├── ffd_airfoil.py             # FFD airfoil 생성
│   ├── optimize_airfoil.py        # 메인 최적화 스크립트
│   ├── validate_scenario.py       # 시나리오 검증
│   └── optimize/                  # 최적화 모듈
│       ├── parametrization.py     # 형상 매개변수화 (NACA/CST/FFD)
│       ├── surrogate.py           # Surrogate 모델
│       └── xfoil_interface.py     # XFOIL 인터페이스
├── scenarios/               # 최적화 시나리오 (YAML)
│   ├── cruise_wing.yaml           # 순항 익형 최적화
│   ├── high_lift.yaml             # 고양력 익형 최적화
│   ├── low_speed.yaml             # 저속 UAV 익형
│   ├── propeller.yaml             # 프로펠러 익형
│   ├── wind_turbine.yaml          # 풍력 터빈 익형
│   └── control_surface.yaml       # 조종면 익형
├── output/                  # 프로젝트 산출물 (gitignore)
│   ├── airfoil/             # 생성된 airfoil 형상
│   ├── analysis/            # XFOIL 해석 결과
│   ├── surrogate/           # Surrogate model 학습 결과
│   └── optimization/        # 최적화 결과
├── public/airfoil/          # 공유 airfoil 저장소
├── environment.yml          # Conda 환경 설정
├── Dockerfile               # Docker 이미지 정의
├── docker-compose.yml       # Docker Compose 설정
└── README.md gate/          # Surrogate model 학습 결과
│   └── optimization/       # 최적화 결과
├── public/airfoil/         # 공유 airfoil 저장소
├── environment.yml         # Conda 환경 설정
├── Dockerfile              # Docker 이미지 정의
├── docker-compose.yml      # Docker Compose 설정
├── FFD_Tutorial.ipynb      # FFD 학습용 Jupyter 노트북
├── FFD_QUICKSTART.md       # FFD 빠른 시작 가이드
└── README.md               # 본 문서
```

## 개발 환경 정보

- **Base OS**: Ubuntu 22.04
- **Fortran Compiler**: gfortran
- **C/C++ Compiler**: gcc/g++
- \*빠른 시작

### 1. 시나리오 검증

```bash
docker-compose exec xfoil-dev bash

# 모든 시나리오 검증
python scripts/validate_scenario.py --all

# 특정 시나리오 검증
python scripts/validate_scenario.py --scenario scenarios/cruise_wing.yaml
```

### 2. 최적화 실행

```bash
# 순항 익형 최적화 (NACA + Kriging)
python scripts/optimize_airfoil.py --scenario scenarios/cruise_wing.yaml

# 고양력 익형 최적화 (CST + Neural Network)
python scripts/optimize_airfoil.py --scenario scenarios/high_lift.yaml

# 프로펠러 익형 최적화 (FFD + Neural Network)
python scripts/optimize_airfoil.py --scenario scenarios/propeller.yaml --verbose
```

### 3. 결과 확인

```bash
# 최적화 결과 확인
ls output/optimization/cruise_wing/

# 최적 airfoil 형상
cat output/optimization/cruise_wing/optimal_airfoil.dat

# 최적화 히스토리
cat output/optimization/cruise_wing/optimization_history.json
```

## 사용 예제

### NACA Airfoil 생성

```bash
docker-compose exec xfoil-dev bash

# 단일 NACA airfoil 생성
python scripts/generate_naca_airfoil.py 2412

# 여러 airfoil 일괄 생성
python scripts/generate_naca_airfoil.py --batch
```

### FFD (Free Form Deformation) Airfoil 생성

```bash
# 단일 FFD airfoil 생성
python scripts/ffd_airfoil.py --naca 2412 --control-points 5 3 --amplitude 0.02

# Surrogate model용 다중 샘플 생성
python scripts/ffd_airfoil.py --naca 2412 --samples 100

# 생성된 샘플 확인
ls output/airfoil/ffd/
```

**FFD 주요 파라미터:**

- `--control-points NX NY`: 제어점 개수 (기본: 5 3)
- `--amplitude`: 변형 크기 (chord 비율, 기본: 0.02)
- `--samples N`: 생성할 랜덤 샘플 개수
- `--plot`: 변형 결과 시각화

### 커스텀 시나리오 생성

````yaml
# scenarios/my_custom.yaml
name: "Custom Airfoil Optimization"
description: "My custom optimization scenario"
category: "A. Fixed-Wing Aircraft"

parametrization:
  method: cst  # naca, cst, or ffd
  n_upper: 6
  n_lower: 6

design_points:
  - reynolds: 500000
    aoa: 5.0
    mach: 0.0
    weight: 0.5
  - reynolds: 1000000
    aoa: 8.0
    mach: 0.0
    weight: 0.5

objectives:
  - metric: "CL/CD"
    type: maximize
    weight: 1.0

optimization:
  algorithm: scipy
  method: SLSQP
  max_iterations: 100
  convergence_tol: 1e-6

surrogate:
  m형상 매개변수화 방법

### 1. NACA (3 parameters)
- **적용**: 간단한 익형 최적화, 초기 설계
- **파라미터**: m (캠버), p (캠버 위치), t (두께)
- **Surrogate**: Kriging/GPR 권장
- **샘플 수**: 30-60개

### 2. CST (8-30 parameters)
- **적용**: 일반적인 익형 최적화, 고양력 장치
- **파라미터**: Bernstein polynomial 계수
- **Surrogate**: Kriging 또는 Neural Network
- **샘플 수**: 80-600개

### 3. FFD (15-100+ parameters)
- **적용**: 복잡한 형상 최적화, 프로펠러, 터빈
- **파라미터**: 제어점 변위 (nx × ny × 2)
- **Surrogate**: Neural Network 권장
- **샘플 수**: 500-2000개

## 최적화 시나리오

| 시나리오 | 카테고리 | 매개변수화 | Surrogate | 목적 |
|---------|---------|-----------|-----------|-----|
| `cruise_wing.yaml` | 고정익 | NACA | Kriging | max L/D |
| `high_lift.yaml` | 고정익 | CST | Neural Net | max CL_max |
| `low_speed.yaml` | 고정익 | CST | Kriging | max CL^1.5/CD |
| `propeller.yaml` | 회전익 | FFD | Neural Net | multi-point |
| `wind_turbine.yaml` | 회전익 | CST | Neural Net | max AEP |
| `control_surface.yaml` | 조종면 | NACA | Kriging | effectiveness |

## 필요 패키지

```bash
# 컨테이너 내부에서 설치
pip install scikit-learn scikit-optimize torch pyyaml

# 또는 conda 환경에 추가
conda install -c conda-forge scikit-learn scikit-optimize pytorch pyyaml
````

## 문제 해결

### XFOIL 관련

```bash
# xfoil 재빌드
cd /workspace/xfoil
rm -rf build && mkdir build && cd build
cmake .. && make && make install
```

### Surrogate 모델 학습 실패

- **데이터 부족**: 파라미터당 10-20개 샘플 필요
- **스케일 문제**: 입력/출력 정규화 확인
- **수렴 실패**: XFOIL 설정 조정 (n_iter, reynolds)

### 최적화 수렴 안됨

- **초기값**: 실현 가능한 초기 설계 확인
- **제약조건**: 너무 엄격한 제약 완화
- **알고리즘**: Scipy → Genetic → Bayesian 순서로 시도bash

# xfoil 재빌드

cd /workspace/xfoil
rm -rf build
mkdir build && cd build
cmake ..
make
make install

````

### MPI 관련 오류

```bash
# MPI 환경 확인
mpirun --version

# 테스트 실행
mpirun -np 4 python your_script.py
````

## 라이선스

XFOIL: GNU General Public License v2.0

## 참고 자료

- [XFOIL 공식 웹사이트](http://web.mit.edu/drela/Public/web/xfoil/)
- [XFOIL Documentation](xfoil/xfoil_doc.txt)
